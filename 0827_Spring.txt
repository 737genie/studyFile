0827 Spring

<ë¬¸ì œì  ìˆ˜ì •>
08/26 ì˜¤ë¥˜ ë°œìƒí•œ ì´ìœ :
ë°›ì•„ì˜¤ëŠ” ê°ì²´ì˜ ë¬¸ì œê°€ ìˆì„ ë•Œ ì˜¤ë¥˜ê°€ ë°œìƒí•¨ 
	-> dtoì™€ bindingResultì— ë¬¸ì œê°€ ìˆìŒ


-> TestController.java

@PreAuthorize("isAuthenticated()") 
	@PostMapping("/create")
	public String createPost(@Valid @ModelAttribute("dto") PostCreateDto dto, 
			BindingResult bindingResult,
			@RequestParam("file") MultipartFile file) {
		
		if(bindingResult.hasErrors()) {
			return "create";
		}
		
		try {
			postService.save(dto, file);
		} catch(Exception e) {
			e.printStackTrace();
		}
		return "redirect:/show";
	}


>>> @ModelAttribute("dto") ì¶”ê°€

// ê°„í˜¹ dto, ì—”í‹°í‹° ê°ì²´ê°€ ì œëŒ€ë¡œ í…œí”Œë¦¿ì— ì „ë‹¬ì´ ì•ˆ ë  ìˆ˜ ìˆìŒ
// ê·¸ëŸ´ ë• í•´ë‹¹ dto, ì—”í‹°í‹° ê°ì²´ì— @ModelAttribute ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•  ê²ƒ





<í˜ì´ì§• ì²˜ë¦¬>

-> TestApplication.java

    // ì‹œë‚˜ë¦¬ì˜¤ 10
    // í˜ì´ì§• ì²˜ë¦¬
    // í˜ì´ì§€ : ê°€ìƒì˜ ë©”ëª¨ë¦¬ë¥¼ ë™ì¼í•œ í¬ê¸°ì˜ ë¸”ë¡ìœ¼ë¡œ ë‚˜ëˆˆ ë‹¨ìœ„
    // í˜ì´ì§• : CS(Computer Science)ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë©”ëª¨ë¦¬ ê´€ë¦¬ ê¸°ë²•
    // -> OS(ìš´ì˜ì²´ì œ)ê°€ í”„ë¡œì„¸ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë©”ëª¨ë¦¬ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ë°©ë²•
    
    // í˜ì´ì§• ì²˜ë¦¬ : UIì— í‘œí˜„ë˜ëŠ” ëŒ€ëŸ‰ì˜ ë°ì´í„°ë¥¼ ë‚˜ëˆ„ì–´ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ê¸°ë²•
    // -> ex 1800ê°œì˜ ê²Œì‹œê¸€ ë°ì´í„°ë¥¼ í•œ ë²ˆì— ë‹¤ ë¶ˆëŸ¬ì˜¤ëŠ” ê²Œ ì•„ë‹Œ, 
    // ->    í˜ì´ì§• ì²˜ë¦¬ë¡œ 10ê°œì”©ë§Œ ë¶ˆëŸ¬ì˜¤ë„ë¡ í•´ì„œ ì„œë²„ì˜ ë¶€í•˜ë¥¼ ë§‰ê³  ì‚¬ìš©ìê°€ í™œìš©í•  ì¥ì¹˜ì˜ ë¶€ë‹´ë„ ì¤„ì´ëŠ” ê²ƒ
    
    // ë„ì„œê´€ì— ë¹„ìœ í•œ í˜ì´ì§•
    // ë„ì„œê´€ ì „ì²´ = dbì— ì €ì¥ëœ ë°ì´í„°
    // í•œ ì±…ì¥(ì„œê°€) = í•œ í˜ì´ì§€ì— ë³´ì—¬ì¤„ ë°ì´í„°
    // ë„ì„œê´€ ì•ˆë‚´ì› = Pageable ê°ì²´
    // ì±…ì¥ ëª©ë¡í‘œ = Page ê°ì²´

    // ê¸‰í•˜ëƒ¥(ì»¨íŠ¸ë¡¤ëŸ¬), ì™€í”Œê³°(ì„œë¹„ìŠ¤), ì¹´í”¼ë°”ë¼(ë°ì´í„°)
    // ì¹´í”¼ë°”ë¼ - JPA ëª…ì„¸ ê¸°ìˆ ì„ ì‚¬ìš©í•´ì„œ ë°ì´í„°ë¥¼ ìš”ì²­ë°›ì€ ëŒ€ë¡œë§Œ ì •í™•í•˜ê³  ë¹ ë¥´ê²Œ ì°¾ì•„ì¤Œ


-> WordWarehouse.java
>>> í˜ì´ì§• ì²˜ë¦¬ ì¨ë‘”ê±° ì§€ìš°ê¸°

// í˜ì´ì§• ì²˜ë¦¬ë¥¼ ë•ëŠ” í´ë˜ìŠ¤(ê°ì²´)
// Page : í˜ì´ì§• ê·¸ ìì²´ë¥¼ ìœ„í•œ í´ë˜ìŠ¤
// Pageable : í˜ì´ì§• ì²˜ë¦¬ë¥¼ ì‹¤ì§ˆì ìœ¼ë¡œ ì§„í–‰í•˜ëŠ” í´ë˜ìŠ¤
// PageRequest : í˜„ì¬ í˜ì´ì§€ì™€ í•œ í˜ì´ì§€ì— ë³´ì—¬ì¤„ ê²Œì‹œë¬¼ ê°œìˆ˜ ë“±ì„ ì„¤ì •í•˜ì—¬
//		í˜ì´ì§• ìš”ì²­ì„ ì§„í–‰í•˜ëŠ” í´ë˜ìŠ¤

// í˜ì´ì§• ê´€ë ¨ í…œí”Œë¦¿ë‹¨(íƒ€ì„ë¦¬í”„ ê¸°ì¤€)ì˜ ì£¼ìš” ì½”ë“œ
// th:classappend="${!paging.hasPrevious} ? 'disabled'"
// -> ì´ì „ í˜ì´ì§€ê°€ ì—†ìœ¼ë©´ 'ì´ì „' ë§í¬ë¥¼ ë¹„í™œì„±í™”
// 	 (í•´ë‹¹í•˜ëŠ” ê°ì²´ê°€ ì—†ìœ¼ë©´ í•´ë‹¹ ë§í¬ ë¹„í™œì„±í™”)

-> main/java/com.example.demo ì— í´ë˜ìŠ¤íŒŒì¼ ë§Œë“¤ê¸°
-> PostSpecification.java



package com.example.demo;

import org.springframework.data.jpa.domain.Specification;

import jakarta.persistence.criteria.CriteriaBuilder;
import jakarta.persistence.criteria.CriteriaQuery;
import jakarta.persistence.criteria.Predicate;
import jakarta.persistence.criteria.Root;

// í•´ë‹¹ ê°ì²´ì— ëŒ€í•œ ì •ì˜ì„œ
// -> 'Post ê°ì²´ë¥¼ ê²€ìƒ‰í•˜ê¸° ìœ„í•œ ì„¸ë¶€ì‚¬í•­'ì„ ì •ì˜í•œ í´ë˜ìŠ¤
public class PostSpecification {
	
	// Post ì—”í‹°í‹°ì— ëŒ€í•œ ê²€ìƒ‰ ì¡°ê±´ ëª…ì„¸ë¥¼ ìœ„í•œ ë©”ì„œë“œ
	public static Specification<Post> search(String keyword) {
		return new Specification<Post>() {
			
			// ì˜¤ë²„ë¼ì´ë”©ëœ ì¸í„°í˜ì´ìŠ¤, ê°ì²´ë“¤ì€ ì „ë¶€ JPA ê´€ë ¨ ê°ì²´
			// JPA Criteria 
			// -> ê°ì²´ì§€í–¥ í”„ë¡œê·¸ë˜ë°ì„ ê¸°ë°˜ìœ¼ë¡œ DBì˜ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” API
			// CriteriaBuilder : ì¿¼ë¦¬ ì¡°ê±´ ìƒì„±í•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ” ê°ì²´
			// CriteriaQuery : ì¿¼ë¦¬ êµ¬ì¡° ì •ì˜í•˜ëŠ” ê°ì²´
			@Override
			public Predicate toPredicate(Root<Post> root, CriteriaQuery<?> query, CriteriaBuilder cb) {
				query.distinct(true);
				return cb.or(
						cb.like(root.get("title"), "%" + keyword + "%"),
						cb.like(root.get("content"), "%" + keyword + "%")
						);
			}
		};
	}
}




-> PostService

//public List<Post> findAll() {
//	return postRepository.findAll();
//}

>>> ëª¨ë“  ê²Œì‹œê¸€ ì¡°íšŒí•˜ëŠ” ë©”ì„œë“œ ì£¼ì„ ì²˜ë¦¬

>>> ì´ ë¶€ë¶„ ì¶”ê°€ (import ì£¼ì˜! data.domain$)
	public Page<Post> findAll(String keyword, int page) {
		List<Sort.Order> sorts = new ArrayList<>();
		// ì •ë ¬ ê¸°ì¤€ ë§Œë“¤ê¸°
		sorts.add(Sort.Order.desc("createAt")); // ê¸€ ì“´ ì‹œê°„ ë‚´ë¦¼ì°¨ìˆœ (ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬)
		
		// í˜ì´ì§€ ë‹¹ 10ê°œì”© ë³´ì—¬ì£¼ì„¸ìš”
		// PageRequest : 
		// -> ë³€ìˆ˜ page : ì»¨íŠ¸ë¡¤ëŸ¬ë¡œë¶€í„° ë„˜ì–´ì˜¤ëŠ” íŒŒë¼ë¯¸í„°
		// -> 10 : ë³´ì—¬ì¤„ ê°œìˆ˜
		// -> Sorts.by(@@@) : ì •ë ¬ ê¸°ì¤€ì„ @@@ë¡œ ì¡ê² ë‹¤
		Pageable pageable = PageRequest.of(page, 10, Sort.by(sorts));
		
		// Specification : JPAì—ì„œ ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì§„ ì¸í„°í˜ì´ìŠ¤
		// -> ê¸°ë°˜ì€ Criteria
		// -> ëª©ì  = ë™ì ì¸ ì¿¼ë¦¬ ìƒì„±
		// PostSpecification : Post ê°ì²´ì— ëŒ€í•œ ê²€ìƒ‰ ì¡°ê±´ì„ ì •ì˜
		Specification<Post> spec = PostSpecification.search(keyword);
		
		return postRepository.findAll(spec, pageable);
	}

>>> ì´ì œ ì»¨íŠ¸ë¡¤ëŸ¬ì— findAll ë©”ì†Œë“œ ì“´ ê³³ ì°¾ì•„ì„œ ìˆ˜ì •í• ê±°ì„


-> TestController

@GetMapping("/show")
public String showPostForm(Model model,
		@RequestParam(value="page", defaultValue="0") int page,
		@RequestParam(value="kw", defaultValue="") String kw
		) {
		
	Page<Post> posts = postService.findAll(kw, page);
		
	model.addAttribute("paging", posts); 
	model.addAttribute("kw", kw);

	return "board";
}

>>> ì¶”ê°€í•œ ë¶€ë¶„
@RequestParam(value="page", defaultValue="0") int page,
@RequestParam(value="kw", defaultValue="") String kw

>>> ìˆ˜ì •ëœ ë¶€ë¶„
Page<Post> posts = postService.findAll(kw, page);
		
model.addAttribute("paging", posts); 
model.addAttribute("kw", kw);



-> PostRepository

@Repository
public interface PostRepository 
	extends JpaRepository<Post, Long>, JpaSpecificationExecutor<Post> { 
	
}



-> board.html


<!-- ê²€ìƒ‰ì°½ -->
<div class="my-4 flex justify-end">
	<form th:action="@{/show}" method="get" id="searchForm" class="flex space-x-2">
	<input type="text" name="kw" id="search_kw" class="border rounded-lg px-2 py-1" th:value="${kw}">
	<button type="submit" class="bg-blue-500 text-white px-4 py-1 rounded-lg">ì°¾ê¸°</button>
	</form>
</div>
		
		
<!-- ê²Œì‹œê¸€ ëª©ë¡ -->
<div class="space-y-4">
	<!-- th:eachë¥¼ ì‚¬ìš©í•´ ëª¨ë¸ì— ë‹´ê¸´ postsë¥¼ í•˜ë‚˜ì”© êº¼ë‚´ ë°˜ë³µí•©ë‹ˆë‹¤. -->
	<div th:each="post : ${paging.content}" class="p-6 border rounded-lg hover:shadow-lg transition-shadow duration-300 bg-white">
		<a th:href="@{|/show/${post.id}|}">
			<h2 class="text-2xl font-bold text-green-700" 
			th:text="${post.id}"> idê°’</h2>
			<h2 class="text-2xl font-bold text-green-700" 
			th:text="${post.title}"> ê²Œì‹œê¸€ ì œëª©</h2>
		</a>
	<p class="text-gray-600 mt-2" th:text="${post.content}">ê²Œì‹œê¸€ ë‚´ìš©ì…ë‹ˆë‹¤. ì—¬ëŸ¬ ì¤„ì´ ë“¤ì–´ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤...</p>
	<div class="text-right text-sm text-gray-400 mt-4">
		<span th:text="${#temporals.format(post.createAt, 'yyyy-MM-dd HH:mm')}">2025-08-04 10:30</span>
	</div>
	<!-- ê²Œì‹œê¸€ì´ ì—†ì„ ë•Œ ë³´ì—¬ì¤„ ë©”ì‹œì§€ -->
	<!--<div th:if="${paging.isEmpty()}" class="text-center py-10 px-6 border rounded-lg bg-gray-50">
		<p class="text-gray-500">ì•„ì§ ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ì–´ìš”.</p>
		<p class="text-gray-500">ì²« ë²ˆì§¸ ì†Œì‹ì„ ì „í•´ì£¼ì„¸ìš”!</p>
		<div class="mt-6 bg-purple-50 p-4 rounded-lg text-sm">
		<p><span class="font-bold text-purple-600">ì¹´í”¼ë°”ë¼</span>: "ì œ ë°ì´í„° ì°½ê³ ê°€ ì•„ì§ í…… ë¹„ì–´ìˆì–´ìš”... ğŸ¦¦" </p>
		</div>
	</div>-->
</div>
<div th:if="${paging.isEmpty()}" class="text-center py-10 px-6 border rounded-lg bg-gray-50">
	<p class="text-gray-500">ì¡°íšŒëœ ê²Œì‹œê¸€ì´ ì—†ì–´ìš”.</p>
</div>
</div>



